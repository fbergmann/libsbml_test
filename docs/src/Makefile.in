## @configure_input@
##
## File name   : Makefile.in
## Description : Makefile for libSBML documentation
## Author(s)   : Michael Hucka <mhucka@caltech.edu>
## Organization: CDS, Caltech
## Language    : Make
## Created     : 2000-10-17
## Revision    : Makefile,v 1.1.1.1 2002/12/05 23:59:38 mhucka Exp
##
## Copyright 2003-2004 California Institute of Technology and
## Japan Science and Technology Corporation.
##
## This library is free software; you can redistribute it and/or modify it
## under the terms of the GNU Lesser General Public License as published
## by the Free Software Foundation; either version 2.1 of the License, or
## any later version.
##
## This library is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF
## MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  The software and
## documentation provided hereunder is on an "as is" basis, and the
## California Institute of Technology and Japan Science and Technology
## Corporation have no obligations to provide maintenance, support,
## updates, enhancements or modifications.  In no event shall the
## California Institute of Technology or the Japan Science and Technology
## Corporation be liable to any party for direct, indirect, special,
## incidental or consequential damages, including lost profits, arising
## out of the use of this software and its documentation, even if the
## California Institute of Technology and/or Japan Science and Technology
## Corporation have been advised of the possibility of such damage.  See
## the GNU Lesser General Public License for more details.
##
## You should have received a copy of the GNU Lesser General Public License
## along with this library; if not, write to the Free Software Foundation,
## Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.
##
## The original code contained here was initially developed by:
##
##     Michael Hucka and Ben Bornstein
##     SBML Team
##     Control and Dynamical Systems, MC 107-81
##     California Institute of Technology
##     Pasadena, CA, 91125, USA
##
##     http://www.sbml.org
##     mailto:sbml-team@caltech.edu
##
## Contributor(s):
##


# -----------------------------------------------------------------------------
# Configuration variables
# -----------------------------------------------------------------------------
# Some of the following are substituted automatically by `configure'.  If
# you are looking at "Makefile", do not edit these values; instead, run the
# configure script at the top level of the src tree.  It will recreate
# "Makefile".

include @top_srcdir@/config/makefile-common-vars.mk

# `srcdir' points to the current directory, but should be set by configure.
# `subdir' must be set manually to the relative dir under srcdir.  Don't 
# set `subdir' to an absolute path, or some `make' actions will fail.

srcdir  = @srcdir@
thisdir = docs/src

# The following are convenience variables for use in this makefile.

manuals = libsbml-manual libsbml-api-ref
formats = pdf ps html

libsbml-manual-files  = $(foreach format,$(formats),libsbml-manual.$(format))
libsbml-api-ref-files = $(foreach format,$(formats),libsbml-api-ref.$(format))

# The variable `docs' is used in `makefile-common-actions.mk' for install-docs.

docs    = $(libsbml-manual-files) $(libsbml-api-ref-files) \
	libsbml-manual libsbml-api-ref 

# The variable `extra_clean' is used in `makefile-common-actions.mk'
# for `make dist'.  Normally you wouldn't want to remove documentation
# files, but these are all generated files and directories.

tex_ext = aux bbl blg log out toc dvi

extra_clean = \
	$(libsbml-manual-files) \
	$(libsbml-api-ref-files) \
	$(addprefix libsbml-manual.,$(tex_ext)) \
	$(addprefix libsbml-api-ref.,$(tex_ext)) \
	libsbml-manual \
	libsbml-api-ref \
	$(pdffiles)

extra_distclean = Doxyfile sbmlmanual.perl

# The `make dist' rules for this directory are more complicated than usual.
# There are additional separate rules below.

distfiles = \
	Doxyfile.in \
	Doxygen-html-footer.html \
	Doxygen.css \
	Makefile.in \
	README.txt \
	createAPISection.py \
	createAPISections.sh \
	graphics \
	libsbml-api-ref.html.tmpl \
	libsbml-api-ref.tex \
	libsbml-manual.tex \
	libsbml.bib


# -----------------------------------------------------------------------------
# Primary build actions
# -----------------------------------------------------------------------------

# The default rules in `makefile-common-actions.mk' know to interpret goals
# of the form `foo-recursive' to run 'make foo' in directories defined in
# variable `subdirs'.

# The default action is not to make anything.  You have to run `make pdf'
# or `make html' or `make libsbml-manual', etc., explicitly.

all:

check:

dvi: $(foreach manual,$(manuals),$(manual).dvi)

pdf: $(foreach manual,$(manuals),$(manual).pdf)

ps: $(foreach manual,$(manuals),$(manual).ps)

html: $(foreach manual,$(manuals),$(manual).html)

info:
	@echo "We're sorry, but the info format is not supported."

# The following constructs some additional targets for convenience.
# Lets you use `make libsbml-manual' to create all the libsbml-manual files.

libsbml-manual:  $(libsbml-manual-files)
libsbml-api-ref: $(libsbml-api-ref-files)


# -----------------------------------------------------------------------------
# libsbml-manual
# -----------------------------------------------------------------------------

manual_html_dir = libsbml-manual

epsfiles        = $(wildcard graphics/*.eps)
pdffiles        = $(epsfiles:.eps=.pdf)

add-sbmlmanual-link = \
  { test -L ./sbmlmanual.perl || ln -s tex/sbmlmanual.perl; }

latex-env := TEXINPUTS=".:tex//:../tex//:${TEXINPUTS}::" 

# Yes, run pdflatex 4 times after running bibtex here.

libsbml-manual.pdf: libsbml-manual.tex $(pdffiles)
	@$(add-sbmlmanual-link)
	-@/bin/rm -f libsbml-manual.toc libsbml-manual.aux
	$(latex-env) pdflatex libsbml-manual
	-bibtex libsbml-manual
	$(latex-env) pdflatex libsbml-manual
	$(latex-env) pdflatex libsbml-manual
	$(latex-env) pdflatex libsbml-manual
	$(latex-env) pdflatex libsbml-manual

libsbml-manual.dvi: libsbml-manual.tex $(epsfiles)
	@$(add-sbmlmanual-link)
	-@/bin/rm -f libsbml-manual.toc libsbml-manual.aux
	$(latex-env) latex libsbml-manual
	-bibtex libsbml-manual
	$(latex-env) latex libsbml-manual
	$(latex-env) latex libsbml-manual
	$(latex-env) latex libsbml-manual

libsbml-manual.ps: libsbml-manual.dvi
	dvips -o libsbml-manual.ps libsbml-manual

libsbml-manual.html: libsbml-manual.tex libsbml-manual.dvi
	@$(add-sbmlmanual-link)
	$(latex-env) latex2html -white -split +0 -show_section_numbers \
		   -image_type gif -no_navigation -local_icons -discard \
		   -antialias -t "libSBML Developer's Manual" \
		   -mkdir -dir $(manual_html_dir) libsbml-manual
	rm $(manual_html_dir)/index.html
#	ln -s libsbml-manual.html $(manual_html_dir)/index.html
	ln -s $(manual_html_dir)/libsbml-manual.html
	perl -pi -e "s|</HEAD>|</HEAD>\n<BASE HREF=\"libsbml-manual/\">|" \
		$(manual_html_dir)/libsbml-manual.html
	perl -pi -e "s/<TITLE>Contents<\/TITLE>/<TITLE>libSBML Developer's Manual<\/TITLE>/" \
		$(manual_html_dir)/libsbml-manual.html


# -----------------------------------------------------------------------------
# libsbml-api-ref
# -----------------------------------------------------------------------------

api-tex-files = $(wildcard api/*.tex)

create-api-files = { $(SHELL) createAPISections.sh ../../src/sbml; }

libsbml-api-ref.pdf:  libsbml-api-ref.tex  $(api-tex-files)
	$(create-api-files)
	-@/bin/rm -f libsbml-api-ref.toc libsbml-api-ref.aux
	$(latex-env) pdflatex libsbml-api-ref
	-bibtex libsbml-api-ref
	$(latex-env) pdflatex libsbml-api-ref
	$(latex-env) pdflatex libsbml-api-ref
	$(latex-env) pdflatex libsbml-api-ref
	$(latex-env) pdflatex libsbml-api-ref

libsbml-api-ref.dvi: libsbml-api-ref.tex
	-@/bin/rm -f libsbml-api-ref.toc libsbml-api-ref.aux
	$(latex-env) latex libsbml-api-ref
	-bibtex libsbml-api-ref
	$(latex-env) latex libsbml-api-ref
	$(latex-env) latex libsbml-api-ref
	$(latex-env) latex libsbml-api-ref

libsbml-api-ref.ps:  libsbml-api-ref.tex  libsbml-api-ref.dvi
	dvips -o libsbml-api-ref.ps libsbml-api-ref

doxygen-output-dir = libsbml-api-ref

libsbml-api-ref.html: $(api-tex-files)
	$(create-api-files)
	$(shell [ -d $(doxygen-output-dir) ] || mkdir $(doxygen-output-dir))
	doxygen Doxyfile
	cp graphics/sbml-logo-long-124x56.gif $(doxygen-output-dir)
	cp libsbml-api-ref.html.tmpl libsbml-api-ref.html


# -----------------------------------------------------------------------------
# Miscellaneous helpers.
# -----------------------------------------------------------------------------

$(pdffiles): %.pdf: %.eps
	epstopdf $<


# -----------------------------------------------------------------------------
# Installation.
# -----------------------------------------------------------------------------

install: libsbml-manual libsbml-api-ref install-docs

uninstall:

installcheck:


# -----------------------------------------------------------------------------
# Creating distribution (for libSBML maintainers only)
# -----------------------------------------------------------------------------

# Here we have some different rules compared to the default `make dist'
# actions.  We put the docs into ../formatted in the distribution
# directory.  This is so that people receiving distributions can find
# preformatted documentation more easily.  However, this is not done during
# make install; instead, make install puts the docs into
# ${prefix}/share/doc/libsbml, which is more appropriate for a make install.

formatted = $(DISTDIR)/docs/formatted

dist: dist-normal libsbml-manual libsbml-api-ref
	$(shell [ -d $(formatted) ] || mkdir -p $(formatted))
	list='$(docs)'; for file in $$list; do \
	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
	    dir="$$dir"; \
	    $(MKINSTALLDIRS) "$(formatted)/$$dir"; \
	  else \
	    dir=''; \
	  fi; \
	  if test -d $$d/$$file; then \
	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
	      echo Copying $(srcdir)/$$file; \
	      cp -pR $(srcdir)/$$file $(formatted)/$$dir || exit 1; \
	    fi; \
	    cp -pR $$d/$$file $(formatted)/$$dir || exit 1; \
	  else \
	    echo Copying $(formatted)/$$file; \
	    test -f $(formatted)/$$file \
	    || cp -p $$d/$$file $(formatted)/$$file \
	    || exit 1; \
	  fi; \
	done

distcheck:


# -----------------------------------------------------------------------------
# Common default rules.
# -----------------------------------------------------------------------------

include @top_srcdir@/config/makefile-common-actions.mk


# -----------------------------------------------------------------------------
# End.
# -----------------------------------------------------------------------------
